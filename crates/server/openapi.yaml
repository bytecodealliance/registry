openapi: 3.1.0

info:
  version: 1.0.0
  title: Warg Registry API
  description: |
    [warg](https://warg.io/) is an open source protocol for WebAssembly component registries.
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

# The Warg APIs currently do not use an authentication scheme
# Publishing requires that entries are signed with an acceptable key
x-42c-no-authentication: true

# Ignore warnings regarding strings in responses not having a pattern or maximum length
x-42c-skipIssues:
  - v3-schema-response-string-pattern
  - v3-schema-response-string-maxlength

tags:
  - name: fetch
    description: API for fetching checkpoints and logs from the registry.
  - name: package
    description: API for managing package logs in the registry.
  - name: proof
    description: API for proving the integrity of the registry.

servers:
  - url: http://localhost:8090/v1
    description: Local development server

paths:
  /fetch/logs:
    post:
      summary: Fetch registry logs
      operationId: fetchLogs
      security: []
      tags:
        - fetch
      description: |
        Fetch the operator and packages logs from the registry.

        TODO: document operator record format.

        TODO: document package record format.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FetchLogsRequest"
      responses:
        "200":
          description: The logs were successfully fetched.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FetchLogsResponse"
        "404":
          description: A requested entity was not found.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - status
                  - type
                  - id
                properties:
                  status:
                    type: integer
                    description: The HTTP status code for the error.
                    example: 404
                  type:
                    type: string
                    description: The type of entity that was not found.
                    enum: [checkpoint, log, record]
                    example: checkpoint
                  id:
                    type: string
                    description: The identifier of the entity that was not found.
                    example: sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /fetch/checkpoint:
    get:
      summary: Fetch latest registry checkpoint
      operationId: getCheckpoint
      security: []
      tags:
        - fetch
      description: Fetch the latest checkpoint from the registry.
      responses:
        "200":
          description: The checkpoint was successfully fetched.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FetchCheckpointResponse"
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /package/{logId}:
    get:
      summary: Get package log information.
      operationId: getPackageLogInformation
      security: []
      tags:
        - package
      description: |
        Gets the information of a package log.

        A package log identifier is a hash of the following concatenation:
          * A prefix of the byte string `WARG-PACKAGE-LOG-ID-V0`
          * The package name
      parameters:
        - name: logId
          in: path
          description: The package log identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
      responses:
        "200":
          description: The package information.
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PackageLog"
        "404":
          description: A requested entity was not found.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - status
                  - type
                  - id
                properties:
                  status:
                    type: integer
                    description: The HTTP status code for the error.
                    example: 404
                  type:
                    type: string
                    description: The type of entity that was not found.
                    enum: [log]
                    example: log
                  id:
                    "$ref": "#/components/schemas/AnyHash"
                    description: |
                      The identifier of the entity that was not found.
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /package/{logId}/record:
    post:
      summary: Publish a new record to a package log.
      operationId: publishPackageRecord
      security: []
      tags:
        - package
      description: |
        Attempts to publish a new record to a package log.

        Publishing package records is an asynchronous operation.

        The record must be signed by a key that is authorized to modify the package log.

        TODO: document package record format.
      parameters:
        - name: logId
          in: path
          description: The package log identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PublishPackageRecordRequest"
      responses:
        "202":
          description: The package record was accepted.
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PackageRecord"
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /package/{logId}/record/{recordId}:
    get:
      summary: Get a package record.
      operationId: getPackageRecord
      security: []
      tags:
        - package
      description: |
        Gets a package record from the registry.

        A package record is in one of the following states:
          * `sourcing`: The package record needs content sources.
          * `processing`: The package record is being processed.
          * `rejected`: The package record was rejected.
          * `published`: The package record was published to the log.

        TODO: document package record format.
      parameters:
        - name: logId
          in: path
          description: The package log identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
        - name: recordId
          in: path
          description: The record identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
      responses:
        "200":
          description: The package record.
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PackageRecord"
        "404":
          description: A requested entity was not found.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - status
                  - type
                  - id
                properties:
                  status:
                    type: integer
                    description: The HTTP status code for the error.
                    example: 404
                  type:
                    type: string
                    description: The type of entity that was not found.
                    enum: [log, record]
                    example: log
                  id:
                    "$ref": "#/components/schemas/AnyHash"
                    description: |
                      The identifier of the entity that was not found.
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    patch:
      summary: Update content sources of a package record.
      operationId: addPackageRecordContentSources
      security: []
      tags:
        - package
      description: |
        Updates the content sources for an existing package record.

        The package record must be in the `sourcing` state.

        Only missing content sources can be specified.
      parameters:
        - name: logId
          in: path
          description: The package log identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
        - name: recordId
          in: path
          description: The record identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PackageRecordContentSourcesRequest"
      responses:
        "200":
          description: The package record was updated.
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PackageRecord"
        "404":
          description: A requested entity was not found.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - status
                  - type
                  - id
                properties:
                  status:
                    type: integer
                    description: The HTTP status code for the error.
                    example: 404
                  type:
                    type: string
                    description: The type of entity that was not found.
                    enum: [log, record]
                    example: log
                  id:
                    "$ref": "#/components/schemas/AnyHash"
                    description: |
                      The identifier of the entity that was not found.
        "405":
          description: The package record is not in the `sourcing` state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                status: 405
                message: the package record is not in the `sourcing` state
        "501":
          description: Updating package content sources is not supported.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                status: 501
                message: adding content sources is not supported
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /package/{logId}/record/{recordId}/content:
    post:
      summary: Post content for a package record.
      operationId: postPackageRecordContent
      security: []
      tags:
        - package
      description: |
        Posts package record content directly to the registry.

        The package record must be in the `sourcing` state.

        If an implementation does not support this endpoint, clients should update the content sources of the record.
      parameters:
        - name: logId
          in: path
          description: The package log identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
        - name: recordId
          in: path
          description: The record identifier.
          required: true
          schema:
            "$ref": "#/components/schemas/AnyHash"
      requestBody:
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
              maxLength: 1073741824 # 1 GiB limit
      responses:
        "201":
          description: The content was successfully uploaded.
          headers:
            Location:
              description: The URL for accessing the uploaded content.
              schema:
                type: string
                format: uri
                example: https://example.com/content/sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c
        "404":
          description: A requested entity was not found.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - status
                  - type
                  - id
                properties:
                  status:
                    type: integer
                    description: The HTTP status code for the error.
                    example: 404
                  type:
                    type: string
                    description: The type of entity that was not found.
                    enum: [log, record]
                    example: log
                  id:
                    "$ref": "#/components/schemas/AnyHash"
                    description: |
                      The identifier of the entity that was not found.
        "405":
          description: The package record is not in the `sourcing` state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                status: 405
                message: the package record is not in the `sourcing` state
        "501":
          description: Uploading of package content is unsupported.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                status: 501
                message: package content uploading is not supported
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /proof/consistency:
    post:
      summary: Prove registry checkpoint consistency.
      operationId: proveConsistency
      security: []
      tags:
        - proof
      description: |
        Proves the consistency of the registry between two specified checkpoints.

        TODO: document the consistency proof bundle format.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProveConsistencyRequest"
      responses:
        "200":
          description: The consistency proof was generated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProveConsistencyResponse"
        "404":
          description: A requested entity was not found.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - status
                  - type
                  - id
                properties:
                  status:
                    type: integer
                    description: The HTTP status code for the error.
                    example: 404
                  type:
                    type: string
                    description: The type of entity that was not found.
                    enum: [checkpoint]
                    example: checkpoint
                  id:
                    "$ref": "#/components/schemas/AnyHash"
                    description: |
                      The identifier of the entity that was not found.
        "422":
          description: The proof bundle could not be generated.
          content:
            application/json:
              schema:
                oneOf:
                  - "$ref": "#/components/schemas/BundleFailureError"
                discriminator:
                  propertyName: reason
                  mapping:
                    failure: "#/components/schemas/BundleFailureError"
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /proof/inclusion:
    post:
      summary: Prove log leaf inclusion.
      operationId: proveInclusion
      security: []
      tags:
        - proof
      description: |
        Proves that the given log leafs are present in the given registry checkpoint.

        TODO: document the log inclusion proof bundle format.

        TODO: document the map inclusion proof bundle format.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProveInclusionRequest"
      responses:
        "200":
          description: The inclusion proof was generated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProveInclusionResponse"
        "404":
          description: A requested entity was not found.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - status
                  - type
                  - id
                properties:
                  status:
                    type: integer
                    description: The HTTP status code for the error.
                    example: 404
                  type:
                    type: string
                    description: The type of entity that was not found.
                    enum: [checkpoint, leaf]
                    example: checkpoint
                  id:
                    "$ref": "#/components/schemas/AnyHash"
                    description: |
                      The identifier of the entity that was not found.

                      For leafs, the format is `<logId>|<recordId>`.
        "422":
          description: The proof bundle could not be generated.
          content:
            application/json:
              schema:
                oneOf:
                  - "$ref": "#/components/schemas/PackageNotIncludedError"
                  - "$ref": "#/components/schemas/IncorrectProofError"
                  - "$ref": "#/components/schemas/BundleFailureError"
                discriminator:
                  propertyName: reason
                  mapping:
                    packageNotIncluded: "#/components/schemas/PackageNotIncludedError"
                    incorrectProof: "#/components/schemas/IncorrectProofError"
                    failure: "#/components/schemas/BundleFailureError"
        default:
          description: An error occurred when processing the request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
components:
  schemas:
    Error:
      type: object
      description: A generic error response.
      additionalProperties: false
      required:
        - status
        - message
      properties:
        status:
          type: integer
          description: The HTTP status code for the error.
          example: 406
        message:
          type: string
          description: The error message.
          example: the server cannot produce an acceptable response
    AnyHash:
      type: string
      description: Represents a supported hash.
      example: sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c
      pattern: ^(sha256:[a-f0-9]{64,64})$
      minLength: 71
      maxLength: 71
    FetchLogsRequest:
      type: object
      description: A request to fetch logs from the registry.
      additionalProperties: false
      required:
        - checkpoint
      properties:
        checkpoint:
          $ref: "#/components/schemas/AnyHash"
          description: The registry checkpoint hash to fetch from.
        maximumRecords:
          type: integer
          description: The maximum number of operator or package records to return.
          example: 100
          default: 100
          minimum: 1
          maximum: 1000
          format: int16
        operator:
          $ref: "#/components/schemas/AnyHash"
          description: The last known operator record identifier.
        packages:
          type: object
          description: |
            The map of package log identifier to last known package record identifier.

            If the last package record identifier is null, records are returned from the start of the log.
          patternProperties:
            "^sha256:[a-f0-9]{64,64}$":
              $ref: "#/components/schemas/AnyHash"
              description: The last known package record identifier.
              nullable: true
          example:
            "sha256:7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded9773": "sha256:7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded97730"
            "sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c": null
    FetchLogsResponse:
      type: object
      description: A response containing the requested logs.
      additionalProperties: false
      properties:
        more:
          type: boolean
          description: |
            Whether there may be more records available.

            This occurs when the maximum number of records is returned for a log.

            If `true`, the client should make another request with the new last known record identifiers.
          example: false
        operator:
          type: array
          description: The operator log records for the given checkpoint since the last known record.
          maxItems: 1000
          items:
            $ref: "#/components/schemas/EnvelopeBody"
        packages:
          type: object
          description: The map of package log identifier to package records.
          patternProperties:
            "^sha256:[a-f0-9]{64,64}$":
              type: array
              description: The package log records for the given checkpoint since the last known record.
              maxItems: 1000
              items:
                $ref: "#/components/schemas/EnvelopeBody"
          example:
            ? "sha256:7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded97730"
            : - contentBytes: "ZXhhbXBsZQ=="
                keyId: "sha256:7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded97730"
                signature: "ecdsa-p256:MEUCIQCzWZBW6ux9LecP66Y+hjmLZTP/hZVz7puzlPTXcRT2wwIgQZO7nxP0nugtw18MwHZ26ROFWcJmgCtKOguK031Y1D0="
              - contentBytes: "ZXhhbXBsZQ=="
                keyId: "sha256:7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded97730"
                signature: "ecdsa-p256:MEUCIQCzWZBW6ux9LecP66Y+hjmLZTP/hZVz7puzlPTXcRT2wwIgQZO7nxP0nugtw18MwHZ26ROFWcJmgCtKOguK031Y1D0="
            ? "sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c"
            : - contentBytes: "ZXhhbXBsZQ=="
                keyId: "sha256:7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded97730"
                signature: "ecdsa-p256:MEUCIQCzWZBW6ux9LecP66Y+hjmLZTP/hZVz7puzlPTXcRT2wwIgQZO7nxP0nugtw18MwHZ26ROFWcJmgCtKOguK031Y1D0="
    FetchCheckpointResponse:
      type: object
      description: A response containing the latest registry checkpoint.
      additionalProperties: false
      properties:
        checkpoint:
          description: The latest checkpoint of the registry.
          allOf:
            - type: object
              required:
                - contents
              properties:
                contents:
                  $ref: "#/components/schemas/MapCheckpoint"
            - $ref: "#/components/schemas/Signature"
    PublishPackageRecordRequest:
      type: object
      description: A request to publish a record to a package log.
      additionalProperties: false
      required:
        - name
        - record
      properties:
        name:
          type: string
          description: The name of the package log being published to.
          maxLength: 128
          example: wasi:http
        record:
          "$ref": "#/components/schemas/EnvelopeBody"
          description: The package record being published to the log.
        contentSources:
          type: array
          description: The list of known content sources.
          maxItems: 128
          items:
            "$ref": "#/components/schemas/ContentSource"
    PackageLog:
      type: object
      description: Information of a package log.
      additionalProperties: false
      required:
        - id
      properties:
        name:
          type: string
          description: The name of the package log.
          format: package-name
          maxLength: 128
          example: wasi:http
        id:
          "$ref": "#/components/schemas/AnyHash"
          description: The identifier of the package log.
        metadata:
          "$ref": "#/components/schemas/PackageMetadata"
          description: The metadata for the package log.
    PackageRecord:
      description: A package log record.
      allOf:
        - type: object
          required:
            - id
          properties:
            id:
              "$ref": "#/components/schemas/AnyHash"
              description: The record identifier.
        - oneOf:
            - "$ref": "#/components/schemas/SourcingRecord"
            - "$ref": "#/components/schemas/ProcessingRecord"
            - "$ref": "#/components/schemas/RejectedRecord"
            - "$ref": "#/components/schemas/PublishedRecord"
          discriminator:
            propertyName: state
            mapping:
              sourcing: "#/components/schemas/SourcingRecord"
              processing: "#/components/schemas/ProcessingRecord"
              rejected: "#/components/schemas/RejectedRecord"
              published: "#/components/schemas/PublishedRecord"
    PackageRecordContentSourcesRequest:
      type: object
      description: A request to set the content sources of a package record.
      additionalProperties: false
      required:
        - contentSources
      properties:
        contentSources:
          type: array
          description: The list of known content sources.
          minItems: 1
          maxItems: 128
          items:
            "$ref": "#/components/schemas/ContentSource"
        # TODO: sign the array entries so that only an accepted publisher can set the content sources?
    ProveConsistencyRequest:
      type: object
      description: A request to prove the consistency of the registry.
      additionalProperties: false
      required:
        - from
        - to
      properties:
        from:
          $ref: "#/components/schemas/AnyHash"
          description: The starting checkpoint hash.
        to:
          $ref: "#/components/schemas/AnyHash"
          description: The ending checkpoint hash.
    ProveConsistencyResponse:
      type: object
      description: A response containing the consistency proof bundle.
      additionalProperties: false
      required:
        - proof
      properties:
        proof:
          type: string
          description: The consistency proof bundle.
          format: byte
          example: "ZXhhbXBsZQ=="
    ProveInclusionRequest:
      type: object
      description: A request to prove the inclusion of log leafs in a checkpoint.
      additionalProperties: false
      required:
        - checkpoint
        - leafs
      properties:
        checkpoint:
          $ref: "#/components/schemas/MapCheckpoint"
          description: The checkpoint to prove the inclusion for.
        leafs:
          type: array
          maxItems: 1000
          description: The log leafs to prove the inclusion for.
          items:
            type: object
            description: A log leaf.
            required:
              - logId
              - recordId
            properties:
              logId:
                $ref: "#/components/schemas/AnyHash"
                description: The log identifier.
              recordId:
                $ref: "#/components/schemas/AnyHash"
                description: The record identifier.
    ProveInclusionResponse:
      type: object
      description: A response containing the inclusion proof bundle.
      additionalProperties: false
      required:
        - log
        - map
      properties:
        log:
          type: string
          description: The log inclusion proof bundle.
          format: byte
          example: "ZXhhbXBsZQ=="
        map:
          type: string
          description: The map inclusion proof bundle.
          format: byte
          example: "ZXhhbXBsZQ=="
    SourcingRecord:
      type: object
      description: The package record is sourcing content.
      required:
        - state
        - uploadSupported
        - missingContent
      properties:
        state:
          type: string
          description: The state of the package record.
          enum: [sourcing]
          example: sourcing
        uploadSupported:
          type: boolean
          description: Whether or not direct content uploading is supported by the registry.
          example: true
        missingContent:
          type: array
          description: The array of content digests that are missing for the package record.
          minItems: 1
          maxItems: 128
          items:
            "$ref": "#/components/schemas/AnyHash"
    ProcessingRecord:
      type: object
      description: A record that is being processed.
      required:
        - state
      properties:
        state:
          type: string
          description: The state of the package record.
          enum: [processing]
          example: processing
    RejectedRecord:
      type: object
      description: A rejected package record.
      required:
        - state
        - reason
      properties:
        state:
          type: string
          description: The state of the package record.
          enum: [rejected]
          example: rejected
        reason:
          type: string
          description: The reason the package record was rejected.
          example: the first entry of the log is not `init`
    PublishedRecord:
      type: object
      description: A record that has been published to the log.
      required:
        - state
        - checkpoint
        - record
      properties:
        state:
          type: string
          description: The state of the package record.
          enum: [published]
          example: published
        checkpoint:
          description: The checkpoint of the record.
          allOf:
            - type: object
              required:
                - contents
              properties:
                contents:
                  $ref: "#/components/schemas/MapCheckpoint"
            - $ref: "#/components/schemas/Signature"
        record:
          "$ref": "#/components/schemas/EnvelopeBody"
          description: The package record.
        contentSources:
          type: array
          description: The content sources for the package record.
          maxItems: 128
          items:
            "$ref": "#/components/schemas/ContentSource"
    PackageMetadata:
      type: object
      additionalProperties: false
      description: The metadata for a registry package.
      properties:
        description:
          type: string
          description: The description of the package.
          maxLength: 1024
          example: A package for the WebAssembly System Interface (WASI) HTTP API.
        homepage:
          type: string
          description: The URL of the package homepage.
          format: uri
          example: https://example.com/wasi/http
        repository:
          type: string
          description: The URL of the package repository.
          format: uri
          example: https://example.com/wasi/http.git
        license:
          type: string
          description: The SPDX license identifier of the package.
          example: Apache-2.0
        keywords:
          type: array
          description: The list of keywords for the package.
          maxItems: 128
          items:
            type: string
            description: A keyword for the package.
            maxLength: 128
            example: wasi
    MapCheckpoint:
      type: object
      description: |
        A registry checkpoint.

        Checkpoints are hashed by concatenating the following:
          * A prefix of the byte string `WARG-MAP-CHECKPOINT-V0`
          * The LEB128-encoded `logLength`
          * The LEB128-length-prefixed `logRoot`
          * The LEB128-length-prefixed `mapRoot`
      additionalProperties: false
      required:
        - logLength
        - logRoot
        - mapRoot
      properties:
        logLength:
          type: integer
          description: The log length of the checkpoint.
          minimum: 1
          example: 42
        logRoot:
          $ref: "#/components/schemas/AnyHash"
          description: The log root hash of the checkpoint.
        mapRoot:
          $ref: "#/components/schemas/AnyHash"
          description: The map root hash of the checkpoint.
    EnvelopeBody:
      description: A signed envelope body.
      allOf:
        - type: object
          required:
            - contentBytes
          properties:
            contentBytes:
              type: string
              description: |
                Base64-encoded bytes of the content.

                The content of an envelope body is typically a serialized protocol buffer
                representing an operator or package record.
              format: byte
              maxLength: 1048576
              example: "ZXhhbXBsZQ=="
        - $ref: "#/components/schemas/Signature"
    Signature:
      type: object
      description: Represents a signature of content.
      required:
        - keyId
        - signature
      properties:
        keyId:
          $ref: "#/components/schemas/AnyHash"
          description: The signing key identifier.
        signature:
          type: string
          description: The bytes of the signature.
          pattern: ^(ecdsa-p256:(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}={2}))$
          minLength: 107
          maxLength: 107
          example: "ecdsa-p256:MEUCIQCzWZBW6ux9LecP66Y+hjmLZTP/hZVz7puzlPTXcRT2wwIgQZO7nxP0nugtw18MwHZ26ROFWcJmgCtKOguK031Y1D0="
    ContentSource:
      description: A known content source.
      oneOf:
        - "$ref": "#/components/schemas/HttpSource"
      discriminator:
        propertyName: type
        mapping:
          http: "#/components/schemas/HttpSource"
    HttpSource:
      type: object
      description: A known HTTP content source.
      properties:
        type:
          type: string
          description: The type of content source.
          enum: [http]
          example: http
        digest:
          "$ref": "#/components/schemas/AnyHash"
          description: The digest of the content.
        url:
          type: string
          description: The URL of the content.
          example: https://example.com/contents.wasm
          format: uri
    PackageNotIncludedError:
      type: object
      additionalProperties: false
      required:
        - status
        - reason
        - logId
      properties:
        status:
          type: integer
          description: The HTTP status code for the error.
          example: 422
        reason:
          type: string
          description: The reason why the bundle could not be generated.
          enum: [packageNotIncluded]
          example: packageNotIncluded
        logId:
          "$ref": "#/components/schemas/AnyHash"
          description: The identifier of the log that was not included.
    IncorrectProofError:
      type: object
      additionalProperties: false
      required:
        - status
        - reason
        - root
        - found
      properties:
        status:
          type: integer
          description: The HTTP status code for the error.
          example: 422
        reason:
          type: string
          description: The reason why the bundle could not be generated.
          enum: [incorrectProof]
          example: incorrectProof
        root:
          "$ref": "#/components/schemas/AnyHash"
          description: The map or log root hash from the checkpoint that was provided.
        found:
          "$ref": "#/components/schemas/AnyHash"
          description: The hash that was found in the proof.
    BundleFailureError:
      type: object
      additionalProperties: false
      required:
        - status
        - reason
        - message
      properties:
        status:
          type: integer
          description: The HTTP status code for the error.
          example: 422
        reason:
          type: string
          description: The reason why the bundle could not be generated.
          enum: [failure]
          example: failure
        message:
          type: string
          description: The failure error message.
          example: bundle must contain proofs for the same root
